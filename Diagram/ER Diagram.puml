@startuml
' ER Diagram - POTMS (Purchase Order Tracking Management System)
' Updated to match actual Django models

skinparam linetype ortho
hide circle
skinparam packageStyle rectangle

' === Master Data Entities ===

entity "User (ผู้ใช้งาน)" as User {
  *uid : VARCHAR(100) <<PK>>
  --
  email : VARCHAR (unique)
  full_name : VARCHAR(255)
  department : VARCHAR(255)
  phone : VARCHAR(50)
  password : VARCHAR(255) (hashed)
  role : ENUM (user, staff, boss, admin)
  is_active : BOOLEAN
  created_at : DATETIME
  updated_at : DATETIME
}

entity "Project (โครงการ)" as Project {
  *id : INT <<PK>>
  --
  project_code : VARCHAR(50) (unique)
  project_name : VARCHAR(255)
  project_type : ENUM (พัสดุ, ครุภัณฑ์)
  budget_total : DECIMAL(12,2)
  budget_used : DECIMAL(12,2)
  status : VARCHAR(50)
  created_at : DATETIME
}

entity "Vendor (ผู้ขาย)" as Vendor {
  *id : INT <<PK>>
  --
  vendor_name : VARCHAR(255)
  phone : VARCHAR(50)
  email : VARCHAR(255)
  address : TEXT
  created_at : DATETIME
}

entity "MasterItem (รายการสินค้าหลัก)" as MasterItem {
  *id : INT <<PK>>
  --
  item_code : VARCHAR(50) (unique)
  item_name : VARCHAR(255)
  standard_unit : VARCHAR(50)
  category : VARCHAR(100)
  created_at : DATETIME
}

' === Transaction Entities ===

entity "Order (ใบขอซื้อ)" as Order {
  *id : INT <<PK>>
  --
  order_no : VARCHAR(50) (unique)
  order_title : VARCHAR(255)
  order_type : ENUM (พัสดุ, ครุภัณฑ์)
  *project_id : INT <<FK>>
  *requester_id : VARCHAR(100) <<FK>>
  requester_name : VARCHAR(255)
  vendor_name : VARCHAR(255)
  status : ENUM (Draft, รอ, รอรับของ, รับบางส่วน, รับครบ, Rejected)
  total_estimated_price : DECIMAL(12,2)
  required_date : DATE
  order_description : TEXT
  staff_note : TEXT
  created_at : DATETIME
  updated_at : DATETIME
  submitted_at : DATETIME
}

entity "OrderItem (รายการสินค้า)" as OrderItem {
  *id : INT <<PK>>
  --
  *order_id : INT <<FK>>
  item_name : VARCHAR(255)
  quantity : INT
  unit : VARCHAR(50)
  estimated_unit_price : DECIMAL(12,2)
  quantity_received : INT
}

entity "OrderImage (รูปภาพประกอบ)" as OrderImage {
  *id : INT <<PK>>
  --
  *order_id : INT <<FK>>
  image : VARCHAR (file path)
  description : VARCHAR(255)
  uploaded_at : DATETIME
}

entity "DeliveryRecord (บันทึกการรับของ)" as DeliveryRecord {
  *id : INT <<PK>>
  --
  *order_id : INT <<FK>>
  *recorded_by_id : VARCHAR(100) <<FK>>
  delivered_at : DATETIME
  notes : TEXT
}

entity "DeliveryItem (รายการรับของ)" as DeliveryItem {
  *id : INT <<PK>>
  --
  *delivery_id : INT <<FK>>
  *order_item_id : INT <<FK>>
  quantity_received : INT
}

' === Relationships ===

' User relationships
User ||..o{ Order : "Creates (Requester)"
User ||..o{ DeliveryRecord : "Records (Staff)"

' Project relationships
Project ||..o{ Order : "Has Orders"

' Order relationships
Order ||--|{ OrderItem : "Contains Items"
Order ||..o{ OrderImage : "Has Images"
Order ||..o{ DeliveryRecord : "Has Deliveries"

' Delivery relationships
DeliveryRecord ||--|{ DeliveryItem : "Contains Items"
OrderItem ||..o{ DeliveryItem : "Received In"

@enduml