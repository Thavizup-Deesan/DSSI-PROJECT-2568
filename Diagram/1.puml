@startuml GovernmentMaterialProcurement_Activity
title กระบวนการจัดซื้อวัสดุภาครัฐ (End-to-End Activity)

|User (เจ้าหน้าที่พัสดุ)|
start
:1. นำเข้าข้อมูลโครงการและงบประมาณ;
:กำหนดวงเงินงบประมาณ "ค่าวัสดุ";

|System (ระบบ)|
:บันทึกโครงการและงบประมาณ;
:Generate รหัสโครงการ;

|User (เจ้าหน้าที่พัสดุ)|
:2. สร้างใบขอซื้อ (PR);
note right: เลือกวัสดุจาก Master Data\nระบุจำนวนและเหตุผล

|System (ระบบ)|
if (ตรวจสอบงบประมาณคงเหลือ?) then (ไม่พอ)
  :แจ้งเตือน "งบประมาณไม่เพียงพอ";
  stop
else (เพียงพอ)
  :จองงบประมาณ (Reserve Budget);
  :เปลี่ยนสถานะเป็น "รออนุมัติ";
endif

|Approver (หัวหน้าเจ้าหน้าที่)|
:พิจารณาใบขอซื้อ (PR);
if (อนุมัติ?) then (ไม่อนุมัติ/แก้ไข)
  :ส่งกลับให้แก้ไข (Reject);
  |System (ระบบ)|
  :คืนยอดจองงบประมาณ (Release Budget);
  stop
else (อนุมัติ)
  |Approver (หัวหน้าเจ้าหน้าที่)|
  :ลงนามอนุมัติ (E-Signature);
endif

|User (เจ้าหน้าที่พัสดุ)|
:3. ดำเนินการจัดซื้อ (ออกใบ PO);
:เลือกผู้ขาย (Vendor) และระบุวันส่งมอบ;

|System (ระบบ)|
:สร้างใบสั่งซื้อ (PO);
:เปลี่ยนสถานะงบเป็น "ผูกพัน" (Obligated);

|Vendor (ผู้ขาย)|
:จัดส่งวัสดุตามใบสั่งซื้อ;

|Committee (คณะกรรมการตรวจรับ)|
:4. ตรวจรับพัสดุ (Inspection);
note right: ตรวจสอบจำนวนและคุณภาพ

if (ผ่านเกณฑ์?) then (ไม่ผ่าน/ชำรุด)
  :ปฏิเสธการรับ (Reject);
  :แจ้งผู้ขายดำเนินการแก้ไข;
  stop
else (ผ่าน)
  :บันทึกผล "ตรวจรับสมบูรณ์";
  :แนบรูปภาพหลักฐาน;
endif

|System (ระบบ)|
fork
  :5. ตัดงบประมาณจริง (Actual Expense);
fork again
  :เพิ่มยอดวัสดุในคลัง (Update Stock);
  :คำนวณต้นทุนต่อหน่วย;
end fork
:แจ้งเตือนเบิกจ่ายเงิน;

stop
@enduml