@startuml
title Activity Diagram: ระบบสั่งซื้อและตรวจรับพัสดุ
skinparam shadowing false
skinparam state {
  BackgroundColor White
  BorderColor Black
}

|Staff|
start
:Import โครงการ (Excel / CSV);

|User|
:Order Item;
if (เลือกวิธีนำเข้าข้อมูล?) then (Import CSV)
    :Import CSV;
else (กรอกเอง)
    :กรอกสด รายรายการ;
endif

:ตรวจสอบรายการ;

if (ยืนยันการส่ง?) then (กดบันทึก Draft)
    :กดบันทึก;
    note right
        Status: Draft
        (บันทึกแต่ยังไม่ส่ง)
    end note
    stop
else (กดสั่งซื้อ)
    :กดสั่งซื้อ;
    note right
        Status: สั่งซื้อ
    end note
endif

|Staff|
:ดูรายการสั่งซื้อทั้งหมด;
:กดดูรายละเอียด;
note right
    จะเห็นสถานะการสั่งซื้อ
end note

:Print Order และเสนอ Boss Approve;
note right
    Status: รอหัวหน้าอนุมัติ
end note

:ระบุกรรมการตรวจรับ, ผู้สั่ง;

if (ตรวจสอบความถูกต้อง?) then (ต้องแก้ไข)
    :บันทึกแจ้งแก้ไข;
    :เปลี่ยนสถานะใน Dashboard ผู้สั่ง;
    note right
        Status: ต้องแก้ไข
    end note
    
    |User|
    :แก้ไขใบสั่งซื้อ;
    :กดอนุมัติแก้ไข;
    note right
        Status: อนุมัติแก้ไข
    end note
    
    |Staff|
    :ตรวจสอบรายการอีกครั้ง;
else (ถูกต้อง)
endif

:Export เป็น CSV;
:ส่งใบสั่งซื้อให้พัสดุ;
note right
    Status: ส่งรายการให้พัสดุ
end note

:รับของจากพัสดุ;
note right
    Status: รับของจากพัสดุ
end note

:เลือกรายการเพื่อสร้าง Sub Order;
note right
    Status: รอตรวจรับ
end note

:ตรวจรับของ (เปิดใบสั่งซื้อ > นับของ);
:ลงชื่อ + กดลงระบบ;
note right
    Status: ตรวจรับ
end note

|User|
:รับของ;
:เปิดใบสั่งซื้อ;
:เบิกของ;

|Staff|
:Staff กดรับของแล้ว (ยืนยันการจ่าย);
note right
    Status: รับของ
end note

:ระบบปิดการสั่งซื้อ;
note right
    Status: ปิดการสั่งซื้อ
end note

stop

@enduml