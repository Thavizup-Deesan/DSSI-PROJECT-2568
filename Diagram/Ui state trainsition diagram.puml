@startuml
title UI State Diagram: POTMS System
hide empty description

' Define Styles
skinparam state {
  BackgroundColor White
  BorderColor #333333
  ArrowColor #333333
  BackgroundColor<<Composite>> #F0F8FF
  BorderColor<<Composite>> #4682B4
}

state "Project Initialization Phase" as Phase1 <<Composite>> {
    state "Project Draft" as S1 : [UC-01] หน้าจอนำเข้า/แก้ไขโครงการ\nStatus: Draft
    state "Participant Setup" as S2 : [UC-02] หน้าจอระบุผู้รับผิดชอบ\nStatus: Verifying

    [*] --> S1
    S1 --> S2 : Data Verified
    S2 --> S1 : Request Edit
    S2 --> ProjectActive : Click 'Start PRJ'
}

state "Project Active" as ProjectActive {
    
    state "Order Processing Phase" as Phase2 <<Composite>> {
        state "Order Entry" as S3 : [UC-03] หน้าจอบันทึกใบขอซื้อ\nStatus: Drafting
        state "Budget Validation" as S4 : [UC-04] ระบบตรวจสอบวงเงิน\n(System Process)
        state "Budget Reserved" as S5 : [UC-04] หน้าจอ Export XLSX\nและระบุกรรมการ
        state "Approval Pending" as S6 : [UC-05] รอหัวหน้าภาคอนุมัติ\nStatus: Pending

        [*] --> S3
        S3 --> S4 : Submit Order
        S4 --> S3 : [Error] Insufficient Budget
        S4 --> S5 : [Success] Budget Reserved
        S5 --> S6 : Send for Approval
        S6 --> S3 : [Action] Request Modification
        S6 --> Approved : [Action] Approve
    }

    state "Fulfillment Phase" as Phase3 <<Composite>> {
        state "Ready to Order" as Approved : ใบสั่งซื้อได้รับการอนุมัติ\nส่งต่อเจ้าหน้าที่พัสดุ
        state "Partial Receive Entry" as S7 : [UC-06] หน้าจอบันทึกใบเสร็จ\nStatus: Partial/Pending
        
        state "Inspection Process" as S8 {
            state "Waiting Inspection" as S8_1 : [UC-07] รอตรวจรับ
            state "Inspection Result" as S8_Choice <<Choice>>
            
            S8_1 --> S8_Choice : Committee Action
        }

        Approved --> S7
        S7 --> S8_1 : Save & Send to Committee
        
        S8_Choice --> S7 : [Reject] Goods Invalid\n(Return to Seller/Edit)
        S8_Choice --> CheckComplete : [Confirm] Goods Valid
    }

    state "Completion Check" as CheckComplete <<Choice>>
    
    state "Payment Phase" as Phase4 <<Composite>> {
        state "Payment Processing" as S9 : [UC-08] หน้าจอตั้งเบิกจ่าย\nStatus: Ready for Payment
    }

    CheckComplete --> S7 : Items Not Complete\n(Create Next Sub-Order)
    CheckComplete --> S9 : All Items Received
    
    S9 --> S3 : Project Not Closed\n(New Order Cycle)
}

state "Project Closure" as S10 : [UC-09] หน้าจรสรุปและปิดโครงการ\nStatus: Closed

ProjectActive --> S10 : Click 'Close Project'
S10 --> [*]

@enduml