<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ใบขอซื้อครุภัณฑ์ - {{ order.order_no }}</title>
    <style>
        @page {
            size: A4;
            margin: 15mm 15mm 10mm 15mm;
        }

        @font-face {
            font-family: 'TH Sarabun New';
            src: local('TH Sarabun New'), local('THSarabunNew');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'TH Sarabun New', 'Sarabun', 'Tahoma', sans-serif;
            font-size: 16pt;
            line-height: 1.4;
            background: white;
            color: #000;
        }

        .page {
            width: 190mm;
            min-height: 270mm;
            padding: 0;
            margin: 0 auto;
            background: white;
        }

        /* Header with Garuda */
        .header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .garuda {
            width: 60px;
            height: auto;
            margin-right: 15px;
        }

        .garuda img {
            width: 100%;
            height: auto;
        }

        .title-section {
            flex: 1;
            text-align: center;
        }

        .title-section h1 {
            font-size: 24pt;
            font-weight: bold;
            margin-bottom: 3px;
        }

        /* Document Info Lines */
        .doc-info {
            font-size: 16pt;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .doc-info-row {
            display: flex;
            flex-wrap: wrap;
        }

        .doc-info-row .label {
            font-weight: bold;
        }

        .doc-info-row .value {
            margin-left: 5px;
        }

        .dotted-line {
            flex: 1;
            border-bottom: 1px dotted #000;
            margin: 0 5px;
            min-width: 50px;
        }

        .inline-field {
            display: inline;
        }

        /* Form Body */
        .form-body {
            font-size: 16pt;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .form-body p {
            text-indent: 40px;
            margin-bottom: 3px;
        }

        .checkbox {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 1px solid #000;
            margin-right: 3px;
            vertical-align: middle;
        }

        .checkbox.checked::after {
            content: '✓';
            font-size: 12pt;
            display: block;
            text-align: center;
            line-height: 14px;
        }

        /* Items Table */
        table.items {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
            font-size: 14pt;
        }

        table.items th,
        table.items td {
            border: 1px solid #000;
            padding: 4px 6px;
            vertical-align: top;
        }

        table.items th {
            font-weight: bold;
            text-align: center;
            background: #fff;
        }

        table.items .col-no {
            width: 8%;
            text-align: center;
        }

        table.items .col-name {
            width: 32%;
        }

        table.items .col-qty {
            width: 8%;
            text-align: center;
        }

        table.items .col-price {
            width: 14%;
            text-align: center;
        }

        table.items .col-total {
            width: 12%;
            text-align: center;
        }

        table.items .col-reason {
            width: 26%;
        }

        /* Empty rows */
        table.items tbody tr {
            height: 28px;
        }

        /* Total Row */
        .total-row {
            text-align: center;
            font-weight: bold;
            font-size: 16pt;
            padding: 8px 0;
            border: 1px solid #000;
            border-top: none;
        }

        /* Signature Section */
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 14pt;
        }

        .sig-box {
            width: 32%;
        }

        .sig-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .sig-content {
            line-height: 1.6;
            font-size: 14pt;
        }

        .sig-checkbox {
            display: flex;
            align-items: flex-start;
            margin-bottom: 2px;
        }

        .sig-line {
            margin-top: 30px;
            text-align: center;
        }

        .sig-line .name-line {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .sig-line .name-line span {
            margin: 0 3px;
        }

        /* Notes Section */
        .notes {
            margin-top: 15px;
            font-size: 14pt;
            border-top: 1px solid #000;
            padding-top: 8px;
        }

        .notes-title {
            font-weight: bold;
            text-decoration: underline;
        }

        .notes ol {
            margin-left: 20px;
            margin-top: 3px;
        }

        /* Print styles */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .page {
                width: 100%;
                height: auto;
                padding: 0;
            }

            .no-print {
                display: none !important;
            }
        }

        .print-actions {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .print-btn,
        .close-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 10pt;
            font-family: sans-serif;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
        }

        .close-btn {
            background: #666;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="print-actions no-print">
        <button class="print-btn" onclick="exportCSV()" style="background: #2196F3;">CSV</button>
        <button class="print-btn" onclick="window.print()">พิมพ์</button>
        <button class="close-btn" onclick="window.close()">✕ ปิด</button>
    </div>

    <div class="page">
        <!-- Header with Garuda -->
        <div class="header">
            <div class="garuda">
                <!-- Thai Garuda Emblem SVG -->
                <svg viewBox="0 0 200 220" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#000">
                        <!-- Simplified Garuda Symbol -->
                        <ellipse cx="100" cy="50" rx="35" ry="30"/>
                        <polygon points="100,85 70,130 100,115 130,130"/>
                        <polygon points="40,100 70,130 55,150 25,130"/>
                        <polygon points="160,100 130,130 145,150 175,130"/>
                        <polygon points="85,115 75,180 100,160 125,180 115,115"/>
                        <rect x="90" y="160" width="20" height="40"/>
                        <polygon points="60,200 100,190 140,200 100,210"/>
                    </g>
                </svg>
            </div>
            <div class="title-section">
                <h1>ใบขอซื้อครุภัณฑ์</h1>
            </div>
        </div>

        <!-- Document Info -->
        <div class="doc-info">
            <div class="doc-info-row">
                <span class="label">ส่วนราชการ</span>
                <span class="value">คณะวิทยาศาสตร์ มหาวิทยาลัยอุบลราชธานี</span>
                <span style="margin-left: auto;">วันที่<span class="dotted-line" style="width: 30px; display: inline-block;"></span>เดือน<span class="dotted-line" style="width: 60px; display: inline-block;"></span>พ.ศ.<span class="dotted-line" style="width: 40px; display: inline-block;"></span></span>
            </div>
            <div class="doc-info-row">
                <span class="label">เรื่อง</span>
                <span>( ✓ ) ขอซื้อครุภัณฑ์</span>
            </div>
            <div class="doc-info-row">
                <span class="label">เรียน</span>
                <span>คณบดีคณะวิทยาศาสตร์ ผ่านหัวหน้าเจ้าหน้าที่</span>
            </div>
        </div>

        <!-- Form Body -->
        <div class="form-body">
            <p>ด้วย <span class="dotted-line" style="width: 150px; display: inline-block;"></span> ตำแหน่ง <span class="dotted-line" style="width: 150px; display: inline-block;"></span> สังกัด <span class="dotted-line" style="width: 80px; display: inline-block;"></span> โทร<span class="dotted-line" style="width: 60px; display: inline-block;"></span> คณะวิทยาศาสตร์</p>
            <p>มีความประสงค์ให้งานพัสดุดำเนินการ ( ✓ ) ซื้อครุภัณฑ์ เพื่อใช้ ( ) ประกอบการเรียนการสอนในรายวิชา <span class="dotted-line" style="width: 100px; display: inline-block;"></span></p>
            <p>( ✓ ) โครงการ/กิจกรรม <span style="text-decoration: underline;">{{ order.order_title }}</span> ( ) อื่น ๆ <span class="dotted-line" style="width: 150px; display: inline-block;"></span></p>
            <p>โดยขออนุมัติใช้เงินในรหัสโครงการ <span class="dotted-line" style="width: 80px; display: inline-block;"></span> ต้องการใช้ครุภัณฑ์ในวันที่<span class="dotted-line" style="width: 80px; display: inline-block;"></span>รายละเอียดตามรายการ</p>
            <p>ดังตารางต่อไปนี้</p>
        </div>

        <!-- Items Table -->
        <table class="items">
            <thead>
                <tr>
                    <th class="col-no" rowspan="2">ลำดับ<br>ที่</th>
                    <th class="col-name" rowspan="2">รายการ/ยมาค/ลักษณะ</th>
                    <th class="col-qty" rowspan="2">จำนวน</th>
                    <th class="col-price" colspan="2">ราคาประเมิน</th>
                    <th class="col-reason" rowspan="2">ระบุเหตุผลการขอใช้ครุภัณฑ์</th>
                </tr>
                <tr>
                    <th class="col-price">ต่อหน่วย (บาท)</th>
                    <th class="col-total">รวมราคา<br>(บาท)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                <tr>
                    <td class="col-no">{{ forloop.counter }}</td>
                    <td class="col-name">{{ item.item_name }}</td>
                    <td class="col-qty">{{ item.quantity_requested }}</td>
                    <td class="col-price" style="text-align: right;">{{ item.formatted_price }}</td>
                    <td class="col-total" style="text-align: right;">{{ item.formatted_total }}</td>
                    <td class="col-reason">{{ item.remarks|default:"-" }}</td>
                </tr>
                {% endfor %}
                <!-- Empty rows to complete table -->
                {% for i in empty_rows %}
                <tr>
                    <td class="col-no"></td>
                    <td class="col-name"></td>
                    <td class="col-qty"></td>
                    <td class="col-price"></td>
                    <td class="col-total"></td>
                    <td class="col-reason"></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Total Row -->
        <div class="total-row">
            รวมเป็นเงิน {{ grand_total }} บาท
        </div>

        <!-- Signature Section -->
        <div class="signatures">
            <!-- Box 1: ผู้ขอซื้อครุภัณฑ์ -->
            <div class="sig-box">
                <div class="sig-title">1) ผู้ขอซื้อครุภัณฑ์</div>
                <div class="sig-line">
                    <div class="name-line">
                        (ลงชื่อ)<span class="dotted-line" style="width: 100px; display: inline-block;"></span>
                    </div>
                    <div class="name-line">
                        (<span class="dotted-line" style="width: 100px; display: inline-block;"></span>)
                    </div>
                    <div>วันที่<span class="dotted-line" style="width: 100px; display: inline-block;"></span></div>
                </div>
            </div>

            <!-- Box 2: หัวหน้าภาควิชา/หัวหน้างาน -->
            <div class="sig-box">
                <div class="sig-title">2) ความเห็นของหัวหน้าภาควิชา/หัวหน้างาน</div>
                <div class="sig-content">
                    <div class="sig-checkbox"><span class="checkbox"></span> เห็นชอบ</div>
                    <div class="sig-checkbox"><span class="checkbox"></span> ไม่เห็นชอบ เนื่องจาก<span class="dotted-line" style="width: 80px; display: inline-block;"></span></div>
                </div>
                <div class="sig-line">
                    <div class="name-line">
                        (ลงชื่อ)<span class="dotted-line" style="width: 100px; display: inline-block;"></span>
                    </div>
                    <div class="name-line">
                        (<span class="dotted-line" style="width: 100px; display: inline-block;"></span>)
                    </div>
                    <div>วันที่<span class="dotted-line" style="width: 100px; display: inline-block;"></span></div>
                </div>
            </div>

            <!-- Box 3: คณะกรรมการตรวจรับ -->
            <div class="sig-box">
                <div class="sig-title">3) โดยมีคณะกรรมการตรวจรับพัสดุดังนี้</div>
                <div class="sig-content">
                    <div>1.<span class="dotted-line" style="width: 120px; display: inline-block;"></span>(ประธาน)</div>
                    <div>2.<span class="dotted-line" style="width: 120px; display: inline-block;"></span>(กรรมการ)</div>
                    <div>3.<span class="dotted-line" style="width: 120px; display: inline-block;"></span>(กรรมการ)</div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="notes">
            <div class="notes-title">หมายเหตุ :</div>
            <ol>
                <li>กรณีจัดซื้อครุภัณฑ์วงเงินไม่เกิน 100,000 บาท กรรมการตรวจรับไม่น้อยกว่า 1 คน</li>
                <li>กรณีจัดซื้อครุภัณฑ์วงเงินเกิน 100,000 บาท กรรมการตรวจรับไม่น้อยกว่า 3 คน</li>
            </ol>
        </div>
    </div>

    <script>
        // Export CSV function
        function exportCSV() {
            const pathParts = window.location.pathname.split('/');
            const orderIdIndex = pathParts.indexOf('orders') + 1;
            const orderId = pathParts[orderIdIndex];

            if (orderId) {
                window.location.href = '/api/orders/' + orderId + '/export-csv/';
            } else {
                alert('ไม่พบ Order ID');
            }
        }
    </script>
</body>

</html>