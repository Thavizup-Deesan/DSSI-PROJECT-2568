{% extends "base.html" %}
{% block title %}ใบสั่งซื้อของฉัน{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-2xl font-bold">ใบสั่งซื้อของฉัน</h1>
        <p class="text-sm text-base-content/50">รายการใบสั่งซื้อที่สร้างโดยคุณ</p>
    </div>
    <a href="/orders/create/" class="btn btn-primary btn-sm gap-2">
        <span class="material-icons-outlined text-base">add</span> สร้างใบสั่งซื้อ
    </a>
</div>

<div class="card bg-base-200 border border-base-content/5">
    <div class="card-body">
        <div class="overflow-x-auto">
            <table class="table table-zebra">
                <thead><tr><th>เลขที่</th><th>โครงการ</th><th>จำนวนเงิน</th><th>รายการ</th><th>สถานะ</th><th>วันที่สร้าง</th><th>การดำเนินการ</th></tr></thead>
                <tbody id="ordersTable"></tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadOrders() {
        const orders = await apiFetch('/api/orders/');
        const tbody = document.getElementById('ordersTable');
        if (orders.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="text-center text-base-content/40">ยังไม่มีใบสั่งซื้อ</td></tr>';
            return;
        }
        tbody.innerHTML = orders.map(o => `
            <tr class="hover">
                <td><a href="/orders/detail/?id=${o.order_id}" class="link link-primary font-medium">${o.order_no}</a></td>
                <td>${o.project_name}</td>
                <td>฿${parseFloat(o.total_amount).toLocaleString()}</td>
                <td>${o.items_count} รายการ</td>
                <td>${getStatusBadge(o.status)}</td>
                <td class="text-sm opacity-60">${new Date(o.created_at).toLocaleDateString('th-TH')}</td>
                <td>
                    <a href="/orders/detail/?id=${o.order_id}" class="btn btn-ghost btn-xs">ดู</a>
                    ${['Draft','Rejected'].includes(o.status) ? `<a href="/orders/edit/?id=${o.order_id}" class="btn btn-outline btn-xs">แก้ไข</a>` : ''}
                </td>
            </tr>
        `).join('');
    }
    loadOrders();
</script>
{% endblock %}
